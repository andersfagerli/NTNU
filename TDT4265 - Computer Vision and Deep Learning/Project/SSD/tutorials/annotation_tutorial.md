# Walkthrough of TDT4265 Annotation system

Make sure to read through this tutorial before looking at other resources.

## Other resources:
* Labeling tips. From the staff's experience with the tool, here are a couple of tips: [https://piazza.com/class/k53ssppxkwb5yy?cid=185](https://piazza.com/class/k53ssppxkwb5yy?cid=185). 
* Labeling specification. 
* OPENCV CVAT detailed user guide: [https://github.com/opencv/cvat/blob/develop/cvat/apps/documentation/user_guide.md#interface-of-the-annotation-tool](https://github.com/opencv/cvat/blob/develop/cvat/apps/documentation/user_guide.md#interface-of-the-annotation-tool)
* Interpolation mode tutorial: [https://www.youtube.com/watch?v=Hc3oudNuDsY&ab_channel=NikitaManovich](https://www.youtube.com/watch?v=Hc3oudNuDsY&ab_channel=NikitaManovich).

## Login
Open the link to the annotation web server, and log in with your provided username and password.

https://tdt4265-annotering.idi.ntnu.no/
![Login Page](./annotation_images/login_edit.png)

## Open task
Open one of the available tasks visible in the task list by clicking the blue open button.
![Select a task](./annotation_images/createTask.png)

## Change assignee
From the highlighted drop-down menu, assign the task to your username. This will hide the task from other annotators. Then click the circled job text to start annotation.

**When you set yourself as the assignee, you're not able to remove yourself. Therefore, you have to finish the annotation task before starting a new one!**

![Assign yourself the task](./annotation_images/assignTask.png)

## Used labels
These are the labels that you are supposed to be annotating: 

* D00 - Longitudnal Linear Cracks
* D10 - Lateral Linear Cracks
* D20 - Alligator/Complex Cracks
* D40 - Potholes

These are the same labels as from RoadDamageDetection2020 Dataset. All the labels are pre-entered. You just have to choose the label from the drop-down menu when creating a new bounding box.

Here are some annotation guidelines taken from VOC2011 Annotation Guidelines:

What to label:
ALL objects of the defined categories, unless:
* You are unsure what the object is.
* The object is very small (at your discretion). A general rule of thumb is that whatever a human eye can see, computer must be able to recognize. So if you can make out an object and which class it belongs to in the frame, you must label it.
* Do not label what you know but cannot see e.g. if a crack starts to appear in the frame but it is only a dot in the frame, do not label it. Label it only once it is recognisable.

Bounding box:
Mark the bounding box of the visible area of the object (not the estimated total extent of the object). Meaning for occluded objects, mark only the area you can see. Make the boundary as tight as possible.

Reflection:
If the reflection is transparent enough that the damage is clearly visible then mark it. If the reflection is occluding the damage too much then don't mark it.

## Annotation
We will use interpolation mode for annotating damages. Interpolation mode means you draw a bounding box in the frame where the object starts to appear and adjust it every few frames, CVAT will interpolate the bounding box for you in the frames you did not adjust the bounding box. 

When you open a task and start the job, the video file will be browsable on the canvas.

Normal playback of the video can be started and paused with the spacebar, and for a frame by frame view, the D and F keys can be used to skip forwards or backwards, frame by frame. The canvas itself can be moved by clicking and dragging, and using the mouse wheel to zoom in and out.

All tasks comes with auto-annotation generated by a yolov5 model trained on RDD2020, but there are cases where no bounding boxes are present in tasks. It is your job to complete the task of annotating all relevant classes in every frame of the video, and correct the existing bounding boxes. The bounding boxes already there can be adjusted by clicking and dragging the box corners, and new bounding boxes can be made by clicking the "create shape" button in the lower right corner.

Remember to select "Track" when creating a new rectangle. 
![Create new shapes](./annotation_images/startTracking.png) 

You will now be able to create a new bounding box by clicking on the frame shown on the canvas. 

![Part1](./annotation_images/createBB.png)

Click on the point where you want to start the rectangle and then click on the opposite corner to create the box.

![Part 3](./annotation_images/createBB2.png)

Make sure to select the correct class in the dropdown menu below the "create shape button", and try to experiment with the difference between interpolation and annotation drop down options. 

If you create annotation squares, try to experiment with the shortcut ctrl+b, which propogates the current bounding box a set amount of frames forwards in time. This can save time if the object in question does not move much relative to the frame. To delete a bounding box, click the bounding box in question and hit the delete button.

## Task complete
When you complete all frames in the task, click info on top right.

![info](./annotation_images/info.png)

Mark the task as completed and assign yourself another task from the task list.

![info](./annotation_images/complete.png)

Remember to save your work, either from the top left button, or hit ctrl+s.

You can go back to task list by clicking the Tasks option on top.

## Labeling Tips
* Mark all the disjoint cracks separately. If they are two close together such that the bounding boxes are overlapping or one box is inside the other box then mark them as one.
![labelingtip1](./annotation_images/labellingtip1.png)

* If in initial frames cracks appear as separate mark them separately even if in latter frames they appear as single crack. See example below:
![labelingtip2](./annotation_images/labellingtip2.png)  
![labelingtip3](./annotation_images/labellingtip3.png)

* Mark the boundaries of patches such as these as D00.
![labelingtip4](./annotation_images/labellingtip4.png)

* Example of Potholes.
![labelingtip5](./annotation_images/labellingtip5.png)

* Example of Alligator Cracks
![labelingtip6](./annotation_images/labellingtip6.png)
